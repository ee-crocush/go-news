# go-news-aggregator

Микросервис новостного агрегатора, реализованный по принципам Domain-Driven Design (DDD). Осуществляет парсинг новостей из RSS-источников и предоставляет REST API для работы с новостями.

## Назначение

Сервис обеспечивает жизненный цикл новостей:
- Парсинг новостей из настраиваемых RSS-источников
- Хранение новостей в MongoDB с поддержкой поиска
- Пагинация и поиск по заголовкам новостей
- Автоматическое обновление новостной ленты

## Структура проекта

```
├── Dockerfile                      # Docker образ для контейнеризации
├── cmd/
│   └── main.go                     # Точка входа в приложение
├── configs/
│   ├── config.yaml                 # Основная конфигурация
│   └── rss_config.json             # Конфигурация RSS-источников
├── go.mod                          # Go модули
├── go.sum
├── internal/                       # Внутренняя логика приложения
│   ├── app/
│   │   └── run.go                  # Инициализация и запуск приложения
│   ├── domain/                     # Доменный слой (DDD)
│   │   └── post/                   # Агрегат новостей
│   │       ├── contract.go         # Контракты и интерфейсы
│   │       ├── errors.go           # Доменные ошибки
│   │       ├── post.go             # Доменная модель новости
│   │       ├── post_test.go        # Тесты доменной модели
│   │       ├── repository.go       # Интерфейс репозитория
│   │       ├── vo.go               # Value Objects
│   │       └── vo_test.go          # Тесты Value Objects
│   ├── infrastructure/             # Инфраструктурный слой
│   │   ├── config/
│   │   │   └── config.go           # Работа с конфигурацией
│   │   ├── repo/                   # Реализации репозиториев
│   │   │   └── mongo/              # MongoDB репозиторий
│   │   │       ├── init.go         # Инициализация БД
│   │   │       ├── mapper/         # Маппинг данных
│   │   │       │   └── post.go     # Маппер для новостей
│   │   │       └── post.go         # Реализация репозитория
│   │   ├── rss/                    # RSS парсер
│   │   │   ├── parser.go           # Логика парсинга RSS
│   │   │   └── parser_test.go      # Тесты парсера
│   │   └── transport/              # Транспортный слой
│   │       └── httplib/            # HTTP транспорт
│   │           ├── handler/        # HTTP обработчики
│   │           │   ├── dto.go      # Data Transfer Objects
│   │           │   ├── find_all.go # Получение списка новостей
│   │           │   ├── find_by_id.go # Получение новости по ID
│   │           │   ├── find_last.go # Получение последней новости
│   │           │   ├── find_latest.go # Получение последних n новостей
│   │           │   ├── handler.go  # Базовый обработчик
│   │           │   └── health.go   # Health check
│   │           └── router.go       # Настройка маршрутизации
│   └── usecase/                    # Слой бизнес-логики (Use Cases)
│       └── post/                   # Use Cases для новостей
│           ├── dto.go              # Data Transfer Objects
│           ├── find_all.go         # Поиск всех новостей
│           ├── find_all_test.go    # Тесты поиска
│           ├── find_by_id.go       # Поиск по ID
│           ├── find_by_id_test.go  # Тесты поиска по ID
│           ├── find_last.go        # Поиск последней новости
│           ├── find_last_test.go   # Тесты поиска последней
│           ├── find_latest.go      # Поиск последних новостей
│           ├── find_latest_test.go # Тесты поиска последних
│           ├── interfaces.go       # Интерфейсы Use Cases
│           ├── parse_and_store.go  # Парсинг и сохранение
│           └── parse_and_store_test.go # Тесты парсинга
└── schema.sql                      # Схема базы данных (для справки)
```

## Технологии

- **Go 1.21+** - основной язык разработки
- **MongoDB** - основное хранилище новостей
- **HTTP/REST** - API для взаимодействия с клиентами
- **RSS/XML** - парсинг новостей из внешних источников

## Локальная разработка

### Требования
- Go 1.21+
- MongoDB 6.0+

### Запуск приложения
```bash
# Установка зависимостей
go mod download

# Запуск сервиса
go run cmd/main.go
```

### Docker
```bash
# Сборка образа
docker build -t go-news-aggregator .

# Запуск контейнера
docker run -p 8080:8080 go-news-aggregator
```

## Конфигурация

- Основная конфигурация находится в файле `configs/config.yaml` и `.env.local`
- Основная конфигурация находится в файле `configs/rss_config.json`


## API Endpoints

### Новости

#### GET /news/{id}
Получение новости по ID

**Пример запроса:**
```bash
curl -X GET "http://localhost:8081/news/1"
```

**Ответ:**
```json
{
  "post": {
    "id": "507f1f77bcf86cd799439011",
    "title": "Заголовок новости",
    "content": "Полный текст новости...",
    "link": "https://example.com/news/123",
    "pub_time": "2024-01-01T10:00:00Z"
  }
}
```

#### GET /news
Получение списка новостей с пагинацией и поиском

**Параметры запроса:**
- `page` - номер страницы (по умолчанию: 1, опционально)
- `limit` - количество новостей на странице (по умолчанию: 10, максимум: 100, опционально)
- `search` - поиск по заголовку (опционально)

**Пример запроса:**
```bash
curl -X GET "http://localhost:8081/news?page=1&limit=20&search=технологии"
```

**Ответ:**
```json
{
  "news": [
    {
      "id": "507f1f77bcf86cd799439011",
      "title": "Заголовок новости",
      "content": "Полный текст новости...",
      "link": "https://example.com/news/123",
      "pub_time": "2024-01-01T10:00:00Z"
    }
  ],
  "total": 12
}
```

#### GET /news/latest/:limit?
Получение последних N новостей

**Пример запроса:**
```bash
curl -X GET "http://localhost:8081/news/latest?limit=10"
```

**Ответ:**
```json
{
  "news": [
    {
      "id": "507f1f77bcf86cd799439011",
      "title": "Заголовок новости",
      "content": "Полный текст новости...",
      "link": "https://example.com/news/123",
      "pub_time": "2024-01-01T10:00:00Z"
    }
  ]
}
```

#### GET /news/last
Получение последней новости

**Пример запроса:**
```bash
curl -X GET "http://localhost:8081/news/last"
```

**Ответ:**
```json
{
  "id": "507f1f77bcf86cd799439011",
  "title": "Заголовок новости",
  "content": "Полный текст новости...",
  "link": "https://example.com/news/123",
  "pub_time": "2024-01-01T10:00:00Z"
}
```

## RSS Парсер

### Принципы работы
- Периодическое обновление новостей из настроенных RSS-источников
- Автоматическое извлечение метаданных: заголовок, содержание, дата публикации
- Сохранение в MongoDB с индексацией для быстрого поиска


## Архитектура

Сервис построен по принципам Domain-Driven Design (DDD) и Clean Architecture:

- **Domain Layer** - доменные модели новостей, value objects, бизнес-правила
- **Use Case Layer** - сценарии использования приложения
- **Infrastructure Layer** - внешние зависимости (MongoDB, RSS парсер, HTTP)
- **Transport Layer** - входные точки (HTTP handlers)

### Принципы DDD
- **Агрегат Post** - инкапсулирует логику работы с новостями
- **Value Objects** - неизменяемые объекты (Title, Content, PublishedAt)
- **Repository Pattern** - абстракция для работы с хранилищем
- **Domain Services** - бизнес-логика

## Roadmap

### ✅ Реализовано
- Архитектура DDD с разделением на слои
- RSS парсер для автоматического сбора новостей
- MongoDB репозиторий с поиском и пагинацией
- Конфигурируемые RSS-источники
- Базовое тестирование компонентов

### 🚧 Запланированные улучшения

#### Основные улучшения
- [ ] Поддержка различных форматов
- [ ] Улучшение парсера и конфига парсера
- [ ] Retry механизм для временно недоступных источников
- [ ] Улучшенное логгирования
- [ ] Graceful degradation при недоступности источников
- [ ] CRUD для возможности пользователям самостоятельно вести работу с новостями

#### Метрики и мониторинг
- [ ] Интеграция с Prometheus для сбора метрик
- [ ] Метрики производительности API (RPS, latency, error rate)
- [ ] Метрики парсера (источники, успешность, время обработки)
- [ ] Бизнес-метрики (количество новостей, популярные категории)
- [ ] Дашборды в Grafana для визуализации
- [ ] Алертинг при критических ошибках

#### Улучшение парсера (дедупликация)
- [ ] Алгоритм обнаружения дубликатов по содержанию
- [ ] Хэширование контента для быстрого сравнения
- [ ] Fuzzy matching для похожих заголовков
- [ ] Временные окна для группировки похожих новостей
- [ ] Внедрение ИИ для анализа дубликатов
- [ ] Настраиваемые правила дедупликации по источникам
- [ ] Кэширование обработанных новостей

#### Доработка всех тестов
- [ ] Увеличение покрытия unit тестов до 90%
- [ ] Integration тесты для MongoDB репозитория
- [ ] Тесты производительности (load testing)
- [ ] Contract тесты для внешних RSS источников
- [ ] Property-based тесты для парсера
- [ ] Benchmarks для критических операций

#### Улучшение DDD архитектуры
- [ ] Рефакторинг доменных агрегатов с усилением инвариантов
- [ ] Внедрение доменных событий (Domain Events)
- [ ] Реализация Specification pattern для сложных запросов
- [ ] Добавление доменных сервисов для парсинга
- [ ] Улучшение bounded contexts и контрактов

#### Дополнительные улучшения
- [ ] Категоризация новостей с помощью ML
- [ ] Система тегов и метаданных
- [ ] Кэширование популярных запросов (Redis)
- [ ] Rate limiting для защиты API
- [ ] Версионирование API (v1, v2)
- [ ] Webhook уведомления о новых новостях
- [ ] Экспорт новостей в различные форматы (JSON, XML, CSV)

#### Производительность и масштабирование
- [ ] Индексирование MongoDB для оптимизации запросов
- [ ] Connection pooling для MongoDB
- [ ] Async processing для тяжелых операций
- [ ] Компрессия HTTP ответов